#!/bin/sh

# looks for exploitation/probing of vulnerable UDP services
# PER SANS?CERT TA14-017A: UDP-Based Amplification Attacks

#Domain Name System (DNS), Port 53
#Network Time Protocol (NTP), Port  123
#Connection-less Lightweight Directory Access Protocol (CLDAP),  Port 389
#Character Generator Protocol (CharGEN), Port 19
#Simple Service Discovery Protocol (SSDP), Port 1900
#BitTorrent, It depends
#Simple Network Management Protocol version 2 (SNMPv2), Port 161, 162
#Kad, ports 4672 and 4665 but usually this can be altered
#Portmap/Remote Procedure Call (RPC), It depends...
#Quote of the Day (QOTD), Port 17
#Multicast Domain Name System (mDNS), Port 5353
#Network Basic Input/Output System (NetBIOS), Port 137, 138 (I would assume the attack happens on 138  which is the datagram port)
#Quake Network Protocol, Port 27960
#Steam Protocol, Outbound traffic  3478, 4379, 4380 Inbound  27000 to 27015 inclusive
#Routing Information Protocol version 1 (RIPv1),  Port 520
#Lightweight Directory Access Protocol (LDAP), Port 389 or 636 (for secure LDAP)
#Trivial File Transfer Protocol (TFTP) Port 69
#Memcache.  Port 11211


tcpdump -r $1 -w $2.udpexp.cap  "udp and
( port 53 or port 69 or port 19 or port 123 or port 389 or port 1900
  or port 161 or port 162 or port 4672 or port 4655 or port 17 or port 5353
  or port 137 or port 138 or port 27900 or port 3478 or port 4379 or port 4380
  or port 27000 or  port 27000 or  port 27001 or  port 27002 or  port 27003 or  port 27004
  or  port 27005 or  port 27006 or  port 27007 or  port 27008 or  port 27009 or  port 27010
  or  port 27011 or  port 27012 or  port 27013 or  port 27014 or  port 27015 or  port 520
  or  port 389 or  port 636 or  port 11211 )
"
